<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <!-- Latest compiled and minified CSS -->
    <link
      href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css"
      rel="stylesheet"
    />

    <!-- Latest compiled JavaScript -->
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js"></script>
    <link
      href="https://cdn.jsdelivr.net/npm/bootstrap-icons/font/bootstrap-icons.css"
      rel="stylesheet"
    />
  </head>

  <body>
    <h1 class="display-1 text-center text-primary">Grocery Shopping</h1>

    <h2 class="h2 text-center text-primary">Grocery Items</h2>

    <!-- <div class="card bg-primary text-center text-white" style="width:500px">
        <div class="card-body">
            <h4 class="h4">Item 1</h4>
            <button type="button" class="btn btn-success btn-sm">+</button>
            <button type="button" class="btn btn-warning btn-sm">-</button>
            <button type="button" class="btn btn-danger btn-sm">Delete</button>
        </div>
    </div> -->

    <div class="d-flex justify-content-between align-items-center mb-4">
      <button class="btn btn-primary btn-sm" id="addRecordBtn">
        <i class="bi bi-plus-circle me-1"></i> Add Record
      </button>
    </div>
    <div class="container mt-3" id="show-form"></div>
    <div class="container my-5">
      <div class="row justify-content-center">
        <div class="col-md-8">
          <!-- Item Card -->
          <div class="card shadow-lg mb-3">
            <div
              class="card-body d-flex align-items-center justify-content-between"
            >
              <!-- Left (Plus/Minus) -->
              <div class="d-flex align-items-center gap-2">
                <button class="btn btn-outline-success btn-sm">
                  <i class="bi bi-plus-lg"></i>
                </button>
                <button class="btn btn-outline-danger btn-sm">
                  <i class="bi bi-dash-lg"></i>
                </button>
              </div>

              <!-- Center (Item Name + Quantity) -->
              <div class="text-center flex-grow-1">
                <h5 class="mb-1">Apples</h5>
                <small class="text-muted">Quantity: 5</small>
              </div>

              <!-- Right (Delete) -->
              <div>
                <button class="btn btn-outline-secondary btn-sm">
                  <i class="bi bi-trash"></i>
                </button>
              </div>
            </div>
          </div>

          <!-- Repeat for more items -->
          <div class="card shadow-sm mb-3">
            <div
              class="card-body d-flex align-items-center justify-content-between"
            >
              <div class="d-flex align-items-center gap-2">
                <button class="btn btn-outline-success btn-sm">
                  <i class="bi bi-plus-lg"></i>
                </button>
                <button class="btn btn-outline-danger btn-sm">
                  <i class="bi bi-dash-lg"></i>
                </button>
              </div>

              <div class="text-center flex-grow-1">
                <h5 class="mb-1">Bananas</h5>
                <small class="text-muted">Quantity: 10</small>
              </div>

              <div>
                <button class="btn btn-outline-secondary btn-sm">
                  <i class="bi bi-trash"></i>
                </button>
              </div>
            </div>
          </div>
        </div>
      </div>
    </div>
    <div class="alert alert-dark mt-4 text-center" id="summaryBanner">
      <strong>Total:</strong> Quantity = 5 | Price = $10
    </div>

    <!-- Bootstrap JS -->
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js"></script>

    <script>
      var groceryItems = [
        { name: "Apples", Price: 16, Quantity: 10 },
        { name: "Bananas", Price: 22, Quantity: 5 },
        { name: "Snacks", Price: 8, Quantity: 45 },
      ];
      var cartItems = [];
      // var addToCart = (indexId, event) => {
      //   //Split plus-index into [plus, index] and extract arr[1]
      //   let extractedIndex = indexId.split('-')[1]
      //   let {name, Price, Quantity} = groceryItems[extractedIndex]
      //   let item = {name, Price, Quantity}
      //   let indexIfPresent = cartItems.findIndex(cartItem => {
      //     cartItem.name === name
      //     console.log(cartItem.name, name)
      //   })
      //   console.log('index if present', indexIfPresent)
      //   if (indexIfPresent==-1) {
      //     item = {...item, Quantity: 1}
      //     cartItems = [...cartItems, item]
      //     groceryItems[extractedIndex].Quantity -=1
      //     console.log(cartItems)
      //   }
      //   else {
      //     cartItems[indexIfPresent].Quantity +=1
      //     groceryItems[extractedIndex].Quantity -=1
      //   }
      //   console.log(groceryItems)
      //   console.log(cartItems)
      // }
      var renderGrocery = () => {
        let divContainer = document.querySelector(".col-md-8");
        divContainer.innerHTML = "";
        let index = 0;
        groceryItems.forEach((item) => {
          let { name, Price, Quantity } = item;
          //      console.log(name, Price, Quantity)

          let divItem = document.createElement("div");
          divItem.className = "card shadow-sm mb-3";
          let flexItem = document.createElement("div");
          flexItem.className =
            "card-body d-flex align-items-center justify-content-between";

          let left = document.createElement("div");
          left.className = "d-flex align-items-center gap-2";
          let leftPlusBtn = document.createElement("button");
          leftPlusBtn.className = "btn btn-outline-success btn-sm";
          let leftPlusBtnIcon = document.createElement("i");
          leftPlusBtnIcon.className = "bi bi-plus-lg";
          leftPlusBtn.id = `plus-${index}`;

          let leftMinusBtn = document.createElement("button");
          leftMinusBtn.className = "btn btn-outline-danger btn-sm";
          let leftMinusBtnIcon = document.createElement("i");
          leftMinusBtnIcon.className = "bi bi-dash-lg";
          leftMinusBtn.id = `minus-${index}`;

          let divCenter = document.createElement("div");
          divCenter.className = "text-center flex-grow-1";
          let heading5 = document.createElement("h5");
          heading5.className = "mb-1";
          heading5.innerText = name;
          let smallElem = document.createElement("small");
          smallElem.className = "text-muted";
          smallElem.innerText = `Price: $${Price} - Quantity: ${Quantity}`;

          let rightDiv = document.createElement("div");
          let rightBtn = document.createElement("button");
          rightBtn.className = "btn btn-outline-secondary btn-sm";
          let rightBtnIcon = document.createElement("i");
          rightBtnIcon.className = "bi bi-trash";
          rightBtn.id = `trash-${index}`;

          rightBtn.appendChild(rightBtnIcon);
          rightDiv.appendChild(rightBtn);
          divCenter.appendChild(heading5);
          divCenter.appendChild(smallElem);

          rightBtn.addEventListener("click", (event) => {
            //console.log('Right Button clicked', rightBtn.id)
            deleteRecord(rightBtn.id, event);
          });

          leftMinusBtn.addEventListener("click", (event) => {
            //console.log('Left Minus Button clicked')
            decreaseQuantity(leftMinusBtn.id, event);
          });

          leftPlusBtn.addEventListener("click", (event) => {
            //console.log('Left Plus Button Clicked')
            //addToCart(leftPlusBtn.id, event)
            increaseQuantity(leftPlusBtn.id, event);
          });

          leftPlusBtn.appendChild(leftPlusBtnIcon);
          left.appendChild(leftPlusBtn);
          leftMinusBtn.appendChild(leftMinusBtnIcon);
          left.appendChild(leftMinusBtn);
          flexItem.appendChild(left);
          flexItem.appendChild(divCenter);
          flexItem.appendChild(rightDiv);

          divItem.appendChild(flexItem);
          divContainer.appendChild(divItem);
          index += 1;
        });
        sumQuantity();
      };

      function increaseQuantity(indexId, event) {
        let extractedIndex = indexId.split("-")[1];
        groceryItems[extractedIndex].Quantity += 1;
        renderGrocery();
      }

      function decreaseQuantity(indexId, event) {
        let extractedIndex = indexId.split("-")[1];
        groceryItems[extractedIndex].Quantity -= 1;
        if (groceryItems[extractedIndex].Quantity == 0) {
          deleteRecord(indexId, event);
        }
        renderGrocery();
      }

      function deleteRecord(indexId, event) {
        let extractedIndex = indexId.split("-")[1];
        window.alert("Are you sure you want to Delete this Record?");
        groceryItems.splice(extractedIndex, 1);
        renderGrocery();
      }

      function sumQuantity() {
        let totalQuantity = 0;
        let totalPrice = 0;
        groceryItems.map((groceryItem) => {
          totalQuantity += groceryItem.Quantity;
          totalPrice += groceryItem.Price * groceryItem.Quantity;
        });
        renderFooter(totalQuantity, totalPrice);
      }

      function renderFooter(totalQuantity, totalPrice) {
        let footerElem = document.querySelector("#summaryBanner");
        footerElem.innerHTML = `<strong>Total:</strong> Quantity = ${totalQuantity} | Price = $${totalPrice}`;
      }

      document
        .querySelector("#addRecordBtn")
        .addEventListener("click", (event) => {
          let btnElem = document.querySelector('#addRecordBtn')
          btnElem.disabled = true
          createForm(event);
        });

      function createForm(event) {
        let formElem = document.createElement("form");
        formElem.className = "was-validated";
        formElem.innerHTML = `
         <div class="mb-3 mt-3">
          <label for="name">Grocery Item Name:</label>
          <input type="text" class="form-control" id="name" placeholder="Potatoes" name="name" required>
        </div>
        <div class="mb-3">
          <label for="price">Price $</label>
          <input type="number" class="form-control" id="price" placeholder="10" name="price" required>
        </div>
        <div class="mb-3">
          <label for="quantity">Quantity</label>
          <input type="number" class="form-control" id="quantity" placeholder="10" name="quantity" required>
        </div>
        
        <button type="submit" class="btn btn-primary" id="addRecord">Submit</button>
      `;
        let divContainer = document.querySelector("#show-form");
        divContainer.appendChild(formElem);
        document.addEventListener("submit", (event) => {
          event.preventDefault();
          let formData = new FormData(formElem);
          processForm(formData, event);
        });
      }

      function processForm(formData, event) {

        let newItem = {};
        for (const [key, value] of formData) {
          if (key === "name") {
            newItem = { ...newItem, name: value };
          }
          if (key === "price") {
            //console.log(parseInt(value));
            newItem = { ...newItem, Price: parseInt(value) };
          }
            if (key === "quantity") {
              newItem = { ...newItem, Quantity: parseInt(value) };
            }
          }
        groceryItems = [...groceryItems, newItem];
        renderGrocery()
      }

      let parseString = () => {
        let statement = "1-97,5_37, 3-42, 4 292, 2-33, 0 192";
        let arr = [];
        let arrValues = [];
        statement = statement.split(",");
        let i = 0;
        statement.map((elem) => {
          elem = elem.trim();
          let ifSpace = elem.includes(" ");
          let ifDash = elem.includes("-");
          let ifHyphen = elem.includes("_");
          console.log(ifDash);
          if (ifSpace) {
            arrValues[i] = elem.split(" ");
          }
          if (ifDash) {
            arrValues[i] = elem.split("-");
          }

          if (ifHyphen) {
            arrValues[i] = elem.split("_");
          }
          arr[i++] = parseInt(elem);
        });
        console.log("Arr:", arr);
        console.log("ArrValues:", arrValues);
        conversion(arrValues)
      };

      function conversion(arr) {
        result = []
        arr.forEach(value=>{
          let newItem = {[parseInt(value[0])]: parseInt(value[1])}
          result = [...result, newItem]
        })
        console.log('Result', result)
      } 

      parseString();
      renderGrocery();
      sumQuantity();
    </script>
  </body>
</html>
